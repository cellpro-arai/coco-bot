<!DOCTYPE html>
<!--
  経費精算フォーム - React版 SPA
-->
<html>

<head>
  <base target="_top" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />

  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
    }

    .required-label::after {
      content: " *";
      color: var(--pico-del-color);
    }

    .incident-card {
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .incident-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--pico-card-box-shadow);
    }

    .text-truncate-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .text-truncate-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .text-center {
      text-align: center;
    }

    .text-muted {
      color: var(--pico-muted-color);
      font-size: 0.8rem;
    }

    .mb-0 {
      margin-bottom: 0;
    }

    .mb-2 {
      margin-bottom: 0.5rem;
    }

    .mb-3 {
      margin-bottom: 1rem;
    }

    .py-3 {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .py-5 {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }

    .d-flex {
      display: flex;
    }

    .align-items-center {
      align-items: center;
    }

    .justify-content-center {
      justify-content: center;
    }

    .me-2 {
      margin-right: 0.5rem;
    }

    .commute-table-container {
      width: 100%;
      margin-top: 0.5rem;
    }

    .commute-table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .commute-table-header button {
      padding: 0.32rem 0.75rem;
      font-size: 0.82rem;
      line-height: 1;
      min-height: 1.35rem;
    }

    .commute-cards-grid {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-top: 0.5rem;
    }

    .commute-card {
      background: var(--pico-card-background-color);
      border: 1px solid var(--pico-muted-border-color);
      border-radius: var(--pico-border-radius);
      padding: 0.4rem 0.5rem;
      transition: all 0.2s ease;
      display: grid;
      grid-template-columns: 160px 160px 160px 100px 120px 1fr;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.85rem;
    }

    @media (max-width: 1199px) {
      .commute-card {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto auto;
        gap: 0.4rem;
        max-width: 100%;
      }

      .commute-card-field:nth-child(1) {
        /* 日付 */
        grid-column: 1;
        grid-row: 1;
      }

      .commute-card-field:nth-child(2) {
        /* 最寄り駅 */
        grid-column: 1;
        grid-row: 2;
      }

      .commute-card-field:nth-child(3) {
        /* 訪問先駅 */
        grid-column: 2;
        grid-row: 2;
      }

      .commute-card-field:nth-child(4) {
        /* 区分 */
        grid-column: 1;
        grid-row: 3;
      }

      .commute-card-field:nth-child(5) {
        /* 片道の金額 */
        grid-column: 2;
        grid-row: 3;
      }

      .commute-card-actions {
        /* ボタン */
        grid-column: 2;
        grid-row: 1;
        justify-content: flex-end;
      }
    }

    .commute-card:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    .commute-card-field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .commute-card-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--pico-muted-color);
      margin-bottom: 0;
      line-height: 1;
    }

    .commute-card input,
    .commute-card select {
      width: 100%;
      box-sizing: border-box;
      padding: 0.2rem 0.4rem;
      font-size: 0.78rem;
      height: 1.4rem;
      line-height: 1.2;
      margin-bottom: 0;
    }

    .commute-card-actions {
      display: flex;
      gap: 0.35rem;
      justify-content: flex-end;
    }

    .commute-card-actions button {
      padding: 0.25rem 0.6rem;
      font-size: 0.75rem;
      margin-bottom: 0;
      white-space: nowrap;
      line-height: 1;
      min-height: 1.4rem;
    }

    .expense-table-container {
      width: 100%;
      margin-top: 0.5rem;
    }

    .expense-table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .expense-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.35rem;
      font-size: 0.85rem;
      table-layout: fixed;
    }

    .expense-table th,
    .expense-table td {
      padding: 0.2rem 0.3rem;
      border-bottom: 1px solid #dcdcdc;
      vertical-align: middle;
    }

    .expense-table th {
      font-weight: 600;
      text-align: left;
    }

    .expense-table input,
    .expense-table select {
      width: 100%;
      box-sizing: border-box;
      padding: 0.16rem 0.35rem;
      font-size: 0.78rem;
      height: 1.35rem;
      line-height: 1.2;
      margin-bottom: 0;
    }

    .expense-table input[type="file"] {
      padding: 0;
      font-size: 0.78rem;
      height: 1.35rem;
      line-height: 1.35rem;
    }

    .expense-table input[type="file"]::file-selector-button,
    .expense-table input[type="file"]::-webkit-file-upload-button {
      padding: 0.16rem 0.5rem;
      font-size: 0.78rem;
      height: 100%;
      line-height: 1.2;
    }

    .expense-table th:nth-child(1),
    .expense-table td:nth-child(1) {
      width: 12%;
      min-width: 95px;
    }

    .expense-table th:nth-child(2),
    .expense-table td:nth-child(2) {
      width: 30%;
      min-width: 160px;
    }

    .expense-table th:nth-child(3),
    .expense-table td:nth-child(3) {
      width: 12%;
      min-width: 90px;
    }

    .expense-table th:nth-child(4),
    .expense-table td:nth-child(4) {
      width: 18%;
      min-width: 140px;
    }

    .expense-table th:nth-child(5),
    .expense-table td:nth-child(5) {
      width: 18%;
      min-width: 140px;
    }

    .expense-table th:nth-child(6),
    .expense-table td:nth-child(6) {
      width: 10%;
      min-width: 90px;
    }

    .expense-table button {
      margin-bottom: 0;
    }

    .expense-entry-actions {
      display: flex;
      gap: 0.35rem;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .expense-entry-actions button,
    .expense-table-header button {
      padding: 0.32rem 0.75rem;
      font-size: 0.82rem;
      line-height: 1;
      min-height: 1.35rem;
    }

    .work-schedule-input {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .work-schedule-input button {
      padding: 0.2rem 0.6rem;
      font-size: 0.85rem;
      line-height: 1;
      min-height: 1.6rem;
    }

    .work-schedule-input .file-name {
      font-size: 0.85rem;
      color: var(--pico-muted-color);
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const createEmptyCommuteEntry = () => ({
      date: '',
      origin: '',
      destination: '',
      amount: '',
      tripType: 'oneWay'
    });

    const createEmptyExpenseEntry = () => ({
      category: 'other',
      description: '',
      amount: '',
      receiptFile: null,
      certificateFile: null
    });

    function App() {
      const [formData, setFormData] = useState({
        name: '',
        workScheduleFile: null,
        workStartTime: '09:00',
        workEndTime: '18:00',
        hasCommuterPass: 'no',
        nearestStation: '',
        workStation: '',
        monthlyFee: '',
        remarks: '',
        commuteEntries: [],
        expenseEntries: []
      });

      const [submitted, setSubmitted] = useState(false);
      const formRef = useRef(null);
      const workScheduleInputRef = useRef(null);

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({
          ...prev,
          [name]: value
        }));
      };

      const handleFileChange = (e) => {
        const { name, files } = e.target;
        setFormData(prev => ({
          ...prev,
          [name]: files[0] || null
        }));
      };

      const handleWorkScheduleButtonClick = () => {
        if (workScheduleInputRef.current) {
          workScheduleInputRef.current.click();
        }
      };

      const handleCommuteEntryChange = (index, field, value) => {
        setFormData(prev => {
          const updated = prev.commuteEntries.map((entry, idx) => {
            if (idx !== index) {
              return entry;
            }
            return { ...entry, [field]: value };
          });
          return { ...prev, commuteEntries: updated };
        });
      };

      const addCommuteEntry = () => {
        setFormData(prev => ({
          ...prev,
          commuteEntries: [...prev.commuteEntries, createEmptyCommuteEntry()]
        }));
      };

      const removeCommuteEntry = (index) => {
        setFormData(prev => {
          const updated = prev.commuteEntries.filter((_, idx) => idx !== index);
          return { ...prev, commuteEntries: updated };
        });
      };

      const duplicateCommuteEntry = (index) => {
        setFormData(prev => {
          const target = prev.commuteEntries[index];
          const cloned = { ...target, date: '' };
          const updated = [...prev.commuteEntries];
          updated.splice(index + 1, 0, cloned);
          return { ...prev, commuteEntries: updated };
        });
      };

      const handleExpenseEntryChange = (index, field, value) => {
        setFormData(prev => {
          const updated = prev.expenseEntries.map((entry, idx) => {
            if (idx !== index) return entry;
            const nextEntry = { ...entry, [field]: value };
            if (!nextEntry.description && !nextEntry.amount) {
              nextEntry.receiptFile = null;
              nextEntry.certificateFile = null;
            }
            if (field === 'category' && value !== 'exam') {
              nextEntry.certificateFile = null;
            }
            return nextEntry;
          });
          return { ...prev, expenseEntries: updated };
        });
      };

      const handleExpenseReceiptChange = (index, file) => {
        setFormData(prev => {
          const updated = prev.expenseEntries.map((entry, idx) =>
            idx === index ? { ...entry, receiptFile: file } : entry
          );
          return { ...prev, expenseEntries: updated };
        });
      };

      const handleExpenseCertificateChange = (index, file) => {
        setFormData(prev => {
          const updated = prev.expenseEntries.map((entry, idx) =>
            idx === index ? { ...entry, certificateFile: file } : entry
          );
          return { ...prev, expenseEntries: updated };
        });
      };

      const addExpenseEntry = () => {
        setFormData(prev => ({
          ...prev,
          expenseEntries: [...prev.expenseEntries, createEmptyExpenseEntry()]
        }));
      };

      const removeExpenseEntry = (index) => {
        setFormData(prev => {
          const updated = prev.expenseEntries.filter((_, idx) => idx !== index);
          return { ...prev, expenseEntries: updated };
        });
      };

      const collectCommuteEntries = () => {
        const entries = [];

        for (const entry of formData.commuteEntries) {
          const hasValue =
            entry.date || entry.origin || entry.destination || entry.amount;
          if (!hasValue) {
            continue;
          }

          const isComplete =
            entry.date && entry.origin && entry.destination && entry.amount;
          if (!isComplete) {
            throw new Error('交通費の各項目（日時・最寄り駅・訪問先駅・金額）を入力してください。');
          }

          entries.push({ ...entry, tripType: entry.tripType || 'oneWay' });
        }

        return entries;
      };

      const collectExpenseEntries = async () => {
        const entries = [];

        for (const entry of formData.expenseEntries) {
          const hasValue = entry.description || entry.amount;
          if (!hasValue) {
            continue;
          }

          if (!entry.description || !entry.amount) {
            throw new Error('経費の内容と金額を入力してください。');
          }

          if (!entry.receiptFile) {
            throw new Error('経費には領収書の添付が必須です。');
          }

          const category = entry.category || 'other';

          if (category === 'exam' && !entry.certificateFile) {
            throw new Error('試験申請の経費には合格通知書の添付が必須です。');
          }

          const receiptFileData = await encodeFileToBase64(entry.receiptFile);

          if (!receiptFileData) {
            throw new Error('領収書の変換に失敗しました。');
          }

          let certificateFileData = null;
          if (category === 'exam') {
            certificateFileData = await encodeFileToBase64(entry.certificateFile);
            if (!certificateFileData) {
              throw new Error('合格通知書の変換に失敗しました。');
            }
          }

          entries.push({
            category,
            description: entry.description,
            amount: entry.amount,
            receiptFile: receiptFileData,
            certificateFile: certificateFileData
          });
        }

        return entries;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSubmitted(true);

        try {
          // ファイルをBase64エンコード
          const workScheduleFileData = await encodeFileToBase64(formData.workScheduleFile);
          const commuteEntries = collectCommuteEntries();
          const expenseEntries = await collectExpenseEntries();

          // バックエンドに送信するデータを準備
          const expenseData = {
            name: formData.name,
            workScheduleFile: workScheduleFileData,
            workStartTime: formData.workStartTime,
            workEndTime: formData.workEndTime,
            hasCommuterPass: formData.hasCommuterPass,
            nearestStation: formData.nearestStation,
            workStation: formData.workStation,
            monthlyFee: formData.monthlyFee,
            remarks: formData.remarks,
            commuteEntries,
            expenseEntries
          };

          // Google Apps Scriptのバックエンド関数を呼び出し
          google.script.run
            .withSuccessHandler((result) => {
              alert(result.message);
              // フォームをリセット
              if (formRef.current) {
                formRef.current.reset();
              }
              setFormData({
                name: '',
                workScheduleFile: null,
                workStartTime: '09:00',
                workEndTime: '18:00',
                hasCommuterPass: 'no',
                nearestStation: '',
                workStation: '',
                monthlyFee: '',
                remarks: '',
                commuteEntries: [],
                expenseEntries: []
              });
              setSubmitted(false);
            })
            .withFailureHandler((error) => {
              alert('エラーが発生しました: ' + error.message);
              setSubmitted(false);
            })
            .submitExpense(expenseData);
        } catch (error) {
          alert('エラーが発生しました: ' + error.message);
          setSubmitted(false);
        }
      };

      const encodeFileToBase64 = (file) => {
        return new Promise((resolve, reject) => {
          if (!file) {
            resolve(null);
            return;
          }

          const reader = new FileReader();
          reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve({
              name: file.name,
              mimeType: file.type,
              data: base64
            });
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      };

      const hasCommuteEntries = formData.commuteEntries.length > 0;
      const hasExpenseEntries = formData.expenseEntries.length > 0;

      return (
        <>
          <main className="container">
            {/* ヘッダー */}
            <article className="text-center py-3">
              <div className="d-flex align-items-center justify-content-center mb-2">
                <i className="bi bi-receipt me-2" style={{ fontSize: '2rem', color: 'var(--pico-primary)' }}></i>
                <h1 className="mb-0">経費精算フォーム</h1>
              </div>
              <p className="mb-0">
                経費精算に必要な情報を入力してください
              </p>
            </article>

            {/* フォーム */}
            <article>
              <form ref={formRef} onSubmit={handleSubmit}>
                {/* 氏名 */}
                <legend className="required-label">氏名</legend>
                <label htmlFor="name">
                  <input
                    type="text"
                    id="name"
                    name="name"
                    value={formData.name}
                    onChange={handleInputChange}
                    required
                    placeholder="山田 太郎"
                  />
                </label>

                {/* 勤務表 */}
                <fieldset>
                  <label htmlFor="workScheduleFile">勤務表</label>
                  <div className="work-schedule-input">
                    <input
                      ref={workScheduleInputRef}
                      type="file"
                      id="workScheduleFile"
                      name="workScheduleFile"
                      onChange={handleFileChange}
                      accept=".pdf,.xlsx,.xls,.jpg,.jpeg,.png"
                      style={{ display: 'none' }}
                    />
                    <button type="button" className="secondary" onClick={handleWorkScheduleButtonClick}>
                      勤務表を選択
                    </button>
                    {formData.workScheduleFile && (
                      <span className="file-name">{formData.workScheduleFile.name}</span>
                    )}
                  </div>
                </fieldset>

                {/* 交通費 */}
                <fieldset>
                  <legend>交通費</legend>
                  <div className="commute-table-container">
                    <div className="commute-table-header">
                      <small>日付・最寄り駅・訪問先駅・金額を入力してください。</small>
                      <button type="button" className="secondary" onClick={addCommuteEntry}>
                        + 交通費を追加
                      </button>
                    </div>
                    {hasCommuteEntries ? (
                      <div className="commute-cards-grid">
                        {formData.commuteEntries.map((entry, index) => (
                          <div key={`commute-${index}`} className="commute-card">
                            <div className="commute-card-field">
                              <label htmlFor={`commute-date-${index}`} className="commute-card-label">日付</label>
                              <input
                                type="date"
                                id={`commute-date-${index}`}
                                value={entry.date}
                                onChange={(e) => handleCommuteEntryChange(index, 'date', e.target.value)}
                                required
                              />
                            </div>
                            <div className="commute-card-field">
                              <label htmlFor={`commute-origin-${index}`} className="commute-card-label">最寄り駅</label>
                              <input
                                type="text"
                                id={`commute-origin-${index}`}
                                value={entry.origin}
                                onChange={(e) => handleCommuteEntryChange(index, 'origin', e.target.value)}
                                placeholder="例: 渋谷"
                                required
                              />
                            </div>
                            <div className="commute-card-field">
                              <label htmlFor={`commute-destination-${index}`} className="commute-card-label">訪問先駅</label>
                              <input
                                type="text"
                                id={`commute-destination-${index}`}
                                value={entry.destination}
                                onChange={(e) => handleCommuteEntryChange(index, 'destination', e.target.value)}
                                placeholder="例: 新宿"
                                required
                              />
                            </div>
                            <div className="commute-card-field">
                              <label htmlFor={`commute-tripType-${index}`} className="commute-card-label">区分</label>
                              <select
                                id={`commute-tripType-${index}`}
                                value={entry.tripType}
                                onChange={(e) => handleCommuteEntryChange(index, 'tripType', e.target.value)}
                              >
                                <option value="oneWay">片道</option>
                                <option value="roundTrip">往復</option>
                              </select>
                            </div>
                            <div className="commute-card-field">
                              <label htmlFor={`commute-amount-${index}`} className="commute-card-label">片道の金額</label>
                              <input
                                type="number"
                                min="0"
                                id={`commute-amount-${index}`}
                                value={entry.amount}
                                onChange={(e) => handleCommuteEntryChange(index, 'amount', e.target.value)}
                                placeholder="例: 170"
                                required
                              />
                            </div>
                            <div className="commute-card-actions">
                              <button type="button" className="secondary" onClick={() => duplicateCommuteEntry(index)}>
                                複製
                              </button>
                              <button type="button" className="secondary" onClick={() => removeCommuteEntry(index)}>
                                削除
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p className="text-muted">「+ 交通費を追加」を押すと入力欄が表示されます。</p>
                    )}
                  </div>
                </fieldset>

                {/* 経費 */}
                <fieldset>
                  <legend>経費</legend>
                  <div className="expense-table-container">
                    <div className="expense-table-header">
                      <small>ジャンルを選択し、内容と金額を入力してください。試験申請は領収書と合格通知書の添付が必須です。</small>
                      <button type="button" className="secondary" onClick={addExpenseEntry}>
                        + 経費を追加
                      </button>
                    </div>
                    {hasExpenseEntries ? (
                      <table className="expense-table">
                        <thead>
                          <tr>
                            <th id="expense-category-header">ジャンル</th>
                            <th id="expense-description-header">内容</th>
                            <th id="expense-amount-header">金額（円）</th>
                            <th id="expense-receipt-header">領収書</th>
                            <th id="expense-certificate-header">合格通知書</th>
                            <th id="expense-actions-header">操作</th>
                          </tr>
                        </thead>
                        <tbody>
                          {formData.expenseEntries.map((entry, index) => {
                            const category = entry.category || 'other';
                            const isExam = category === 'exam';
                            return (
                              <tr key={`expense-${index}`}>
                                <td>
                                  <select
                                    id={`expense-category-${index}`}
                                    value={category}
                                    aria-labelledby="expense-category-header"
                                    onChange={(e) => handleExpenseEntryChange(index, 'category', e.target.value)}
                                  >
                                    <option value="exam">試験申請</option>
                                    <option value="other">その他</option>
                                  </select>
                                </td>
                                <td>
                                  <input
                                    type="text"
                                    id={`expense-description-${index}`}
                                    value={entry.description}
                                    aria-labelledby="expense-description-header"
                                    onChange={(e) => handleExpenseEntryChange(index, 'description', e.target.value)}
                                    placeholder="例: 備品購入"
                                    required
                                  />
                                </td>
                                <td>
                                  <input
                                    type="number"
                                    min="0"
                                    id={`expense-amount-${index}`}
                                    value={entry.amount}
                                    aria-labelledby="expense-amount-header"
                                    onChange={(e) => handleExpenseEntryChange(index, 'amount', e.target.value)}
                                    placeholder="例: 1200"
                                    required
                                  />
                                </td>
                                <td>
                                  <input
                                    type="file"
                                    id={`expense-receipt-${index}`}
                                    accept=".pdf,.xlsx,.xls,.jpg,.jpeg,.png,.heic"
                                    aria-labelledby="expense-receipt-header"
                                    onChange={(e) => handleExpenseReceiptChange(index, e.target.files[0] || null)}
                                    required
                                  />
                                </td>
                                <td>
                                  {isExam ? (
                                    <input
                                      type="file"
                                      id={`expense-certificate-${index}`}
                                      accept=".pdf,.xlsx,.xls,.jpg,.jpeg,.png,.heic"
                                      aria-labelledby="expense-certificate-header"
                                      onChange={(e) => handleExpenseCertificateChange(index, e.target.files[0] || null)}
                                      required
                                    />
                                  ) : (
                                    <small className="text-muted">不要</small>
                                  )}
                                </td>
                                <td>
                                  <div className="expense-entry-actions" aria-labelledby="expense-actions-header">
                                    <button type="button" className="secondary" onClick={() => removeExpenseEntry(index)}>
                                      削除
                                    </button>
                                  </div>
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    ) : (
                      <p className="text-muted">「+ 経費を追加」を押すと入力欄が表示されます。</p>
                    )}
                  </div>
                </fieldset>

                {/* 現場の定時 */}
                <fieldset>
                  <legend className="required-label">現場の定時</legend>
                  <div className="grid">
                    <label htmlFor="workStartTime">
                      開始
                      <input
                        type="time"
                        id="workStartTime"
                        name="workStartTime"
                        value={formData.workStartTime}
                        onChange={handleInputChange}
                        required
                      />
                    </label>

                    <label htmlFor="workEndTime">
                      終了
                      <input
                        type="time"
                        id="workEndTime"
                        name="workEndTime"
                        value={formData.workEndTime}
                        onChange={handleInputChange}
                        required
                      />
                    </label>
                  </div>
                </fieldset>

                {/* 定期券購入 */}
                <fieldset>
                  <legend className="required-label">定期券購入</legend>
                  <label>
                    <input
                      type="radio"
                      name="hasCommuterPass"
                      value="yes"
                      checked={formData.hasCommuterPass === 'yes'}
                      onChange={handleInputChange}
                    />
                    有り
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="hasCommuterPass"
                      value="no"
                      checked={formData.hasCommuterPass === 'no'}
                      onChange={handleInputChange}
                    />
                    無し
                  </label>
                </fieldset>

                {/* 定期券詳細（条件付き表示） */}
                {formData.hasCommuterPass === 'yes' && (
                  <fieldset>
                    <legend>定期券詳細</legend>

                    <label htmlFor="nearestStation">
                      最寄り駅
                      <input
                        type="text"
                        id="nearestStation"
                        name="nearestStation"
                        value={formData.nearestStation}
                        onChange={handleInputChange}
                        required={formData.hasCommuterPass === 'yes'}
                        placeholder="例: 渋谷駅"
                      />
                    </label>

                    <label htmlFor="workStation">
                      勤務先の駅
                      <input
                        type="text"
                        id="workStation"
                        name="workStation"
                        value={formData.workStation}
                        onChange={handleInputChange}
                        required={formData.hasCommuterPass === 'yes'}
                        placeholder="例: 新宿駅"
                      />
                    </label>

                    <label htmlFor="monthlyFee">
                      月額（円）
                      <input
                        type="number"
                        id="monthlyFee"
                        name="monthlyFee"
                        value={formData.monthlyFee}
                        onChange={handleInputChange}
                        required={formData.hasCommuterPass === 'yes'}
                        min="0"
                        placeholder="例: 15000"
                      />
                    </label>
                  </fieldset>
                )}

                {/* 備考 */}
                <label htmlFor="remarks">
                  備考
                  <textarea
                    id="remarks"
                    name="remarks"
                    value={formData.remarks}
                    onChange={handleInputChange}
                    rows="4"
                    placeholder="その他連絡事項があればご記入ください"
                  ></textarea>
                </label>

                {/* 送信ボタン */}
                <button type="submit" disabled={submitted}>
                  {submitted ? '送信中...' : '提出する'}
                </button>
              </form>
            </article>
          </main>

          {/* フッター */}
          <footer className="container text-center">
            <p className="mb-0">
              <small>&copy; 2025 Demo Inc. All rights reserved.</small>
            </p>
          </footer>
        </>
      );
    }

    // Reactアプリをマウント
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>
